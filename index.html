<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طراح مدار خردایش</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        .input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .input-group input {
            text-align: left;
            direction: ltr;
        }
        .flowchart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border: 2px dashed #9ca3af;
            border-radius: 0.75rem;
            background-color: #f9fafb;
        }
        .flowchart-item {
            background-color: white;
            border: 1px solid #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            width: 180px;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .flowchart-arrow {
            font-size: 2rem;
            color: #6b7280;
            line-height: 1;
        }
        .result-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-xl overflow-hidden">
        <header class="bg-blue-600 text-white p-6">
            <h1 class="text-2xl md:text-3xl font-bold text-center">ابزار هوشمند طراحی مدار خردایش</h1>
            <p class="text-center mt-2 text-blue-200">بر اساس داده‌های استاندارد صنعتی و فرمول‌های مهندسی</p>
        </header>

        <main class="p-6 md:p-8">
            <!-- بخش ورودی اطلاعات -->
            <section id="input-section">
                <h2 class="text-xl font-bold border-b-2 border-blue-500 pb-2 mb-6">۱. مشخصات ورودی و خروجی</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <h3 class="font-bold mb-4 text-lg">مشخصات بار ورودی (Feed)</h3>
                        <div class="space-y-4">
                            <div class="input-group">
                                <label for="feed-rate" class="w-1/2">ظرفیت (تن در ساعت):</label>
                                <input type="number" id="feed-rate" value="250" class="form-input w-1/2 p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="input-group">
                                <label for="f80" class="w-1/2">F80 (میلی‌متر):</label>
                                <input type="number" id="f80" value="400" class="form-input w-1/2 p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <h3 class="font-bold mb-4 text-lg">مشخصات محصول (Product)</h3>
                        <div class="space-y-4">
                             <div class="input-group">
                                <label for="p80" class="w-1/2">P80 (میلی‌متر):</label>
                                <input type="number" id="p80" value="15" class="form-input w-1/2 p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border md:col-span-2">
                        <h3 class="font-bold mb-4 text-lg">مشخصات ماده معدنی</h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="input-group">
                                <label for="work-index" class="w-1/2">شاخص کار باند (Wi):</label>
                                <input type="number" id="work-index" value="14" class="form-input w-1/2 p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="input-group">
                                <label for="bulk-density" class="w-1/2">چگالی (تن بر متر مکعب):</label>
                                <input type="number" id="bulk-density" value="1.6" class="form-input w-1/2 p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <button id="design-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-lg text-lg transition-transform transform hover:scale-105">
                        طراحی مدار
                    </button>
                </div>
            </section>

            <!-- بخش نتایج -->
            <div id="loader" class="hidden loader"></div>
            <section id="results-section" class="mt-10 hidden">
                <h2 class="text-xl font-bold border-b-2 border-green-500 pb-2 mb-6">۲. مدار خردایش پیشنهادی</h2>
                
                <!-- فلوچارت مدار -->
                <div class="mb-8">
                    <h3 class="font-bold text-lg mb-4">فلوچارت شماتیک</h3>
                    <div class="flowchart">
                        <div class="flowchart-item">
                            <p class="font-bold">بار ورودی</p>
                            <p class="text-sm text-gray-600" id="flow-feed-size"></p>
                        </div>
                        <div class="flowchart-arrow">↓</div>
                        <div class="flowchart-item bg-blue-100">
                            <p class="font-bold">سنگ شکن فکی (اولیه)</p>
                            <p class="text-sm text-gray-600" id="flow-jaw-model"></p>
                        </div>
                        <div class="flowchart-arrow">↓</div>
                        <div class="flowchart-item bg-green-100">
                            <p class="font-bold">سرند</p>
                             <p class="text-sm text-gray-600" id="flow-screen-size"></p>
                        </div>
                        <div class="flex justify-center items-center w-full">
                             <div class="text-center">
                                <div class="flowchart-arrow">↓ <span class="text-sm align-top">(بار درشت)</span></div>
                                <div class="flowchart-item bg-yellow-100">
                                    <p class="font-bold">سنگ شکن مخروطی (ثانویه)</p>
                                    <p class="text-sm text-gray-600" id="flow-cone-model"></p>
                                </div>
                             </div>
                             <div class="w-1/3 border-b-2 border-dashed border-gray-400 mx-4"></div>
                             <div class="text-center">
                                <div class="flowchart-arrow">↓ <span class="text-sm align-top">(بار ریز)</span></div>
                                <div class="flowchart-item">
                                    <p class="font-bold">محصول نهایی</p>
                                    <p class="text-sm text-gray-600" id="flow-product-size"></p>
                                </div>
                             </div>
                        </div>
                         <div class="flowchart-arrow transform -rotate-90 -mr-48 -mt-16">⤴</div>
                    </div>
                </div>

                <!-- جزئیات تجهیزات -->
                <div class="space-y-6">
                    <div class="result-card" id="primary-crusher-card"></div>
                    <div class="result-card" id="secondary-crusher-card"></div>
                    <div class="result-card" id="screen-card"></div>
                    <div class="result-card bg-gray-50" id="summary-card"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- پایگاه داده ساده شده از سنگ شکن ها (بر اساس مدل های رایج) ---
        const jawCrushers = [
            { model: 'C96', gape: '930x580', maxFeed: 480, cssRange: [70, 175], capacity: [150, 350], power: 90 },
            { model: 'C110', gape: '1100x700', maxFeed: 600, cssRange: [100, 200], capacity: [250, 550], power: 132 },
            { model: 'C130', gape: '1300x1000', maxFeed: 800, cssRange: [125, 250], capacity: [400, 800], power: 200 },
            { model: 'C150', gape: '1500x1100', maxFeed: 900, cssRange: [150, 300], capacity: [600, 1200], power: 250 }
        ];

        const coneCrushers = [
            { model: 'GP220 Std', maxFeed: 185, cssRange: [16, 36], capacity: [150, 300], power: 160 },
            { model: 'HP300 SH', maxFeed: 120, cssRange: [8, 32], capacity: [100, 250], power: 220 },
            { model: 'GP330 Std', maxFeed: 250, cssRange: [22, 45], capacity: [250, 450], power: 250 },
            { model: 'HP400 SH', maxFeed: 185, cssRange: [10, 38], capacity: [200, 400], power: 315 }
        ];

        // --- عناصر DOM ---
        const designBtn = document.getElementById('design-btn');
        const resultsSection = document.getElementById('results-section');
        const loader = document.getElementById('loader');

        // --- منطق برنامه ---
        designBtn.addEventListener('click', () => {
            loader.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            setTimeout(() => {
                try {
                    const inputs = getInputs();
                    const results = designCircuit(inputs);
                    displayResults(results, inputs);
                    resultsSection.classList.remove('hidden');
                } catch (error) {
                    alert('خطا: ' + error.message);
                } finally {
                    loader.classList.add('hidden');
                }
            }, 1500); // شبیه سازی محاسبات
        });

        function getInputs() {
            const feedRate = parseFloat(document.getElementById('feed-rate').value);
            const f80 = parseFloat(document.getElementById('f80').value);
            const p80 = parseFloat(document.getElementById('p80').value);
            const workIndex = parseFloat(document.getElementById('work-index').value);
            const bulkDensity = parseFloat(document.getElementById('bulk-density').value);

            if (isNaN(feedRate) || isNaN(f80) || isNaN(p80) || isNaN(workIndex) || isNaN(bulkDensity)) {
                throw new Error('لطفاً تمام مقادیر ورودی را به درستی وارد کنید.');
            }
            if (p80 >= f80) {
                throw new Error('P80 باید کوچکتر از F80 باشد.');
            }
            return { feedRate, f80, p80, workIndex, bulkDensity };
        }

        function designCircuit(inputs) {
            // 1. انتخاب سنگ شکن فکی (اولیه)
            const suitableJaw = jawCrushers.find(c => 
                c.maxFeed > inputs.f80 && 
                inputs.feedRate >= c.capacity[0] && 
                inputs.feedRate <= c.capacity[1]
            );
            if (!suitableJaw) throw new Error('سنگ شکن فکی مناسبی برای این مشخصات یافت نشد. لطفاً ظرفیت یا F80 را تغییر دهید.');

            const jawCss = Math.max(suitableJaw.cssRange[0], Math.round(inputs.f80 / 4)); // نسبت خردایش تقریبی 4
            const jawP80 = jawCss * 1.2; // تخمین P80 خروجی از فکی

            // 2. انتخاب سنگ شکن مخروطی (ثانویه)
            // فرض مدار بسته با سرند. بار ورودی به مخروطی تقریباً برابر با بار ورودی مدار است.
            const suitableCone = coneCrushers.find(c => 
                c.maxFeed > jawP80 &&
                inputs.feedRate >= c.capacity[0] && 
                inputs.feedRate <= c.capacity[1]
            );
            if (!suitableCone) throw new Error('سنگ شکن مخروطی مناسبی یافت نشد.');

            const coneCss = Math.max(suitableCone.cssRange[0], Math.round(inputs.p80 / 1.1)); // CSS کمی کوچکتر از P80 نهایی

            // 3. محاسبه توان با فرمول باند
            const powerJaw = 10 * inputs.workIndex * (1 / Math.sqrt(jawP80 * 1000) - 1 / Math.sqrt(inputs.f80 * 1000));
            const powerCone = 10 * inputs.workIndex * (1 / Math.sqrt(inputs.p80 * 1000) - 1 / Math.sqrt(jawP80 * 1000));
            const totalPowerConsumed = (powerJaw + powerCone) * inputs.feedRate; // kWh/t * t/h = kW

            // 4. محاسبه ابعاد سرند
            // فرمول ساده شده: مساحت = ظرفیت / (فاکتور ظرفیت پایه * فاکتورهای تصحیح)
            // اینجا از یک تخمین ساده استفاده می کنیم: 1 متر مربع به ازای هر 15 تن بر ساعت بار روی سرند
            const screenArea = inputs.feedRate / 15;

            return {
                jaw: { model: suitableJaw.model, css: jawCss, p80: jawP80, power: suitableJaw.power, consumedPower: powerJaw * inputs.feedRate },
                cone: { model: suitableCone.model, css: coneCss, power: suitableCone.power, consumedPower: powerCone * inputs.feedRate },
                screen: { size: inputs.p80, area: screenArea.toFixed(1) },
                summary: { totalPower: totalPowerConsumed.toFixed(0), reductionRatio: (inputs.f80 / inputs.p80).toFixed(1) }
            };
        }

        function displayResults(results, inputs) {
            // به روز رسانی فلوچارت
            document.getElementById('flow-feed-size').textContent = `F80: ${inputs.f80} mm`;
            document.getElementById('flow-jaw-model').textContent = results.jaw.model;
            document.getElementById('flow-screen-size').textContent = `مش: ${results.screen.size} mm`;
            document.getElementById('flow-cone-model').textContent = results.cone.model;
            document.getElementById('flow-product-size').textContent = `P80: ${inputs.p80} mm`;

            // نمایش جزئیات تجهیزات
            document.getElementById('primary-crusher-card').innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-blue-700">سنگ شکن اولیه: فکی</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><strong>مدل پیشنهادی:</strong> <span class="font-mono text-blue-900">${results.jaw.model}</span></div>
                    <div><strong>تنظیم دهانه (CSS):</strong> ${results.jaw.css} mm</div>
                    <div><strong>P80 خروجی (تخمینی):</strong> ${results.jaw.p80.toFixed(1)} mm</div>
                    <div><strong>توان نامی موتور:</strong> ${results.jaw.power} kW</div>
                    <div><strong>توان مصرفی (تئوری):</strong> ${results.jaw.consumedPower.toFixed(0)} kW</div>
                </div>`;
            
            document.getElementById('secondary-crusher-card').innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-yellow-700">سنگ شکن ثانویه: مخروطی</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><strong>مدل پیشنهادی:</strong> <span class="font-mono text-yellow-900">${results.cone.model}</span></div>
                    <div><strong>تنظیم دهانه (CSS):</strong> ${results.cone.css} mm</div>
                    <div><strong>توان نامی موتور:</strong> ${results.cone.power} kW</div>
                    <div><strong>توان مصرفی (تئوری):</strong> ${results.cone.consumedPower.toFixed(0)} kW</div>
                </div>`;

            document.getElementById('screen-card').innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-green-700">سرند جداسازی</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><strong>اندازه جدایش (مش):</strong> ${results.screen.size} mm</div>
                    <div><strong>سطح مورد نیاز (تخمینی):</strong> ${results.screen.area} متر مربع</div>
                </div>`;

            document.getElementById('summary-card').innerHTML = `
                <h3 class="font-bold text-lg mb-4 text-gray-700">خلاصه عملکرد مدار</h3>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="bg-indigo-100 p-3 rounded-lg">
                        <div class="text-sm text-indigo-800">مجموع توان مصرفی (تئوری)</div>
                        <div class="text-2xl font-bold text-indigo-900">${results.summary.totalPower} kW</div>
                    </div>
                    <div class="bg-pink-100 p-3 rounded-lg">
                        <div class="text-sm text-pink-800">نسبت خردایش کل</div>
                        <div class="text-2xl font-bold text-pink-900">${results.summary.reductionRatio}</div>
                    </div>
                </div>`;
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ماشین حساب طراحی کارخانه هیپ لیچینگ مس</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-btn.active {
            border-color: #2563eb;
            background-color: #eff6ff;
            color: #1e40af;
        }
        /* Custom styles for better presentation */
        .result-card {
            background-color: #f9fafb;
            border-right: 4px solid #3b82f6;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .result-title {
            font-weight: 600;
            color: #1f2937;
        }
        .result-value {
            font-weight: 700;
            color: #1d4ed8;
            font-size: 1.25rem;
        }
        .result-unit {
            font-size: 0.9rem;
            color: #6b7280;
        }
        .assumption-box {
            background-color: #fffbeb;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-800">ماشین حساب طراحی کارخانه هیپ لیچینگ مس اکسیدی</h1>
            <p class="mt-2 text-lg text-gray-600">پارامترهای اصلی پروژه خود را وارد کنید تا تحلیل جامعی از نیازمندی‌ها دریافت نمایید.</p>
        </header>

        <!-- Inputs Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-2xl font-bold mb-6 border-b-2 border-gray-200 pb-2 text-gray-700">۱. اطلاعات ورودی</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <label for="capacity" class="block text-sm font-medium text-gray-700 mb-1">ظرفیت سالانه کارخانه (تن در سال)</label>
                    <input type="number" id="capacity" value="1000000" class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div>
                    <label for="grade" class="block text-sm font-medium text-gray-700 mb-1">عیار متوسط مس در کانسنگ (%)</label>
                    <input type="number" id="grade" value="0.8" step="0.1" class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div>
                    <label for="density" class="block text-sm font-medium text-gray-700 mb-1">دانسیته کانسنگ (تن بر متر مکعب)</label>
                    <input type="number" id="density" value="1.6" step="0.1" class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
            </div>
            <div class="mt-6 text-center">
                <button id="calculateBtn" class="bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300">
                    محاسبه کن
                </button>
            </div>
        </div>
        
        <!-- Assumptions Section -->
        <div id="assumptions" class="assumption-box mb-8">
            <h3 class="text-xl font-bold mb-4 text-amber-800">۲. مفروضات کلیدی محاسبات</h3>
            <p class="text-sm text-gray-600 mb-4">نتایج زیر بر اساس مقادیر استاندارد صنعتی محاسبه شده‌اند. این مقادیر می‌توانند بر اساس نتایج تست‌های آزمایشگاهی و پایلوت برای کانسنگ شما متفاوت باشند.</p>
            <ul id="assumptionsList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 text-sm">
                <!-- Assumptions will be populated by JS -->
            </ul>
        </div>


        <!-- Results Section -->
        <div id="results" class="bg-white p-6 rounded-xl shadow-md hidden">
            <h2 class="text-2xl font-bold mb-4 border-b-2 border-gray-200 pb-2 text-gray-700">۳. نتایج محاسبات</h2>

            <!-- Tabs Navigation -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="flex flex-wrap -mb-px" id="tabs">
                    <button class="tab-btn active text-lg font-semibold py-4 px-6 border-b-4 border-transparent hover:border-gray-300 focus:outline-none" data-tab="summary">خلاصه تولید</button>
                    <button class="tab-btn text-lg font-semibold py-4 px-6 border-b-4 border-transparent hover:border-gray-300 focus:outline-none" data-tab="heap">طراحی هیپ</button>
                    <button class="tab-btn text-lg font-semibold py-4 px-6 border-b-4 border-transparent hover:border-gray-300 focus:outline-none" data-tab="consumables">مواد مصرفی</button>
                    <button class="tab-btn text-lg font-semibold py-4 px-6 border-b-4 border-transparent hover:border-gray-300 focus:outline-none" data-tab="sxew">کارخانه SX/EW</button>
                    <button class="tab-btn text-lg font-semibold py-4 px-6 border-b-4 border-transparent hover:border-gray-300 focus:outline-none" data-tab="crushing">مدار سنگ‌شکنی</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-content-container">
                <!-- Production Summary -->
                <div id="summary" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Results will be populated by JS -->
                    </div>
                </div>
                <!-- Heap Design -->
                <div id="heap" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Results will be populated by JS -->
                    </div>
                </div>
                <!-- Consumables -->
                <div id="consumables" class="tab-content">
                     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Results will be populated by JS -->
                    </div>
                </div>
                <!-- SX/EW Plant -->
                <div id="sxew" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Results will be populated by JS -->
                    </div>
                </div>
                <!-- Crushing Circuit -->
                <div id="crushing" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Results will be populated by JS -->
                    </div>
                     <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-bold text-blue-800">توضیحات مدار سنگ‌شکنی:</h4>
                        <p class="text-sm text-blue-700 mt-2">مدار پیشنهادی برای رسیدن به دانه بندی هدف (۵-۴۵ میلی‌متر) شامل یک مرحله سنگ‌شکن فکی (اولیه) و یک یا دو مرحله سنگ‌شکن مخروطی (ثانویه و ثالثیه) به همراه سرندهای جداسازی است. انتخاب دقیق مدل تجهیزات نیازمند تحلیل کامل دانه بندی خوراک و مشخصات فیزیکی سنگ (مانند شاخص کار) می‌باشد.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsDiv = document.getElementById('results');
        const assumptionsDiv = document.getElementById('assumptions');
        const assumptionsList = document.getElementById('assumptionsList');
        
        // --- Key Assumptions (can be adjusted) ---
        const ASSUMPTIONS = {
            operatingDays: { value: 350, unit: 'روز در سال', label: 'روزهای کاری' },
            operatingHours: { value: 20, unit: 'ساعت در روز', label: 'ساعات کاری سنگ‌شکن' },
            leachingRecovery: { value: 85, unit: '%', label: 'راندمان لیچینگ' },
            sxewRecovery: { value: 99.5, unit: '%', label: 'راندمان SX/EW' },
            heapHeight: { value: 6, unit: 'متر', label: 'ارتفاع هیپ' },
            leachingCycle: { value: 75, unit: 'روز', label: 'چرخه لیچینگ' },
            irrigationRate: { value: 10, unit: 'L/hr/m²', label: 'نرخ پاشش' },
            acidConsumption: { value: 15, unit: 'kg/ton ore', label: 'مصرف اسید' },
            waterMakeup: { value: 1.5, unit: 'm³/ton Cu', label: 'مصرف آب' },
            lixLoss: { value: 0.1, unit: 'kg/ton Cu', label: 'اتلاف LIX' },
            keroseneLoss: { value: 0.5, unit: 'L/ton Cu', label: 'اتلاف نفت' },
            plsCopperGrade: { value: 3.5, unit: 'g/L', label: 'عیار مس در PLS' },
            currentDensity: { value: 300, unit: 'A/m²', label: 'چگالی جریان EW' },
            currentEfficiency: { value: 92, unit: '%', label: 'راندمان جریان EW' },
            cathodesPerCell: { value: 50, unit: 'عدد', label: 'کاتد در هر سلول' },
            cathodeArea: { value: 1, unit: 'm²', label: 'سطح هر وجه کاتد' },
        };

        // --- Helper function to format numbers ---
        const formatNum = (num) => {
            if (num === null || isNaN(num)) return 'N/A';
            return num.toLocaleString('fa-IR', { maximumFractionDigits: 2 });
        };

        // --- Helper function to create a result card ---
        function createResultCard(title, value, unit) {
            return `
                <div class="result-card">
                    <h4 class="result-title">${title}</h4>
                    <p>
                        <span class="result-value">${formatNum(value)}</span>
                        <span class="result-unit">${unit}</span>
                    </p>
                </div>
            `;
        }
        
        // --- Populate Assumptions List ---
        function populateAssumptions() {
            assumptionsList.innerHTML = '';
            for (const key in ASSUMPTIONS) {
                const item = ASSUMPTIONS[key];
                const li = document.createElement('li');
                li.className = "bg-white p-2 rounded-md shadow-sm";
                li.innerHTML = `<span class="font-semibold text-gray-800">${item.label}:</span> <span class="font-bold text-blue-700">${item.value} ${item.unit}</span>`;
                assumptionsList.appendChild(li);
            }
        }

        // --- Main Calculation Logic ---
        function performCalculations() {
            // 1. Get Inputs
            const capacity = parseFloat(document.getElementById('capacity').value);
            const grade = parseFloat(document.getElementById('grade').value);
            const density = parseFloat(document.getElementById('density').value);

            if (isNaN(capacity) || isNaN(grade) || isNaN(density) || capacity <= 0 || grade <= 0 || density <= 0) {
                alert('لطفاً مقادیر ورودی معتبر وارد کنید.');
                return;
            }

            // 2. Core Calculations
            const A = ASSUMPTIONS;
            
            // Production
            const totalCopperInOre = capacity * (grade / 100);
            const totalRecovery = (A.leachingRecovery.value / 100) * (A.sxewRecovery.value / 100);
            const finalCopperProduction = totalCopperInOre * totalRecovery;
            const dailyCopperProductionKg = (finalCopperProduction * 1000) / A.operatingDays.value;

            // Heap Design
            const dailyOreTon = capacity / A.operatingDays.value;
            const dailyOreVolume = dailyOreTon / density;
            const totalAreaUnderLeach = (capacity / density) * (A.leachingCycle.value / A.operatingDays.value) / A.heapHeight.value;
            const plsFlowRate = (totalAreaUnderLeach * A.irrigationRate.value) / 1000; // m³/hr

            // Consumables
            const dailyAcidTon = (dailyOreTon * A.acidConsumption.value) / 1000;
            const dailyWaterM3 = (finalCopperProduction / A.operatingDays.value) * A.waterMakeup.value;
            const annualLixKg = finalCopperProduction * A.lixLoss.value;
            const annualKeroseneL = finalCopperProduction * A.keroseneLoss.value;

            // SX/EW
            const copperDepositionRate = (dailyCopperProductionKg / 24) / (A.currentEfficiency.value / 100); // kg/hr
            const requiredCurrent = (copperDepositionRate * 2 * 96485) / (63.546 * 3600 / 1000); // Faraday's Law simplified
            const totalCathodes = Math.ceil(requiredCurrent / (A.currentDensity.value * A.cathodeArea.value * 2));
            const ewCells = Math.ceil(totalCathodes / A.cathodesPerCell.value);
            const cellVoltage = 2.1; // Typical voltage
            const rectifierPower = (ewCells * A.cathodesPerCell.value * A.currentDensity.value * A.cathodeArea.value * 2 * cellVoltage) / 1000; // kW
            
            const organicFlowRate = plsFlowRate; // Assuming O/A ratio of 1
            const totalFlowRate = plsFlowRate + organicFlowRate;
            const mixerRetentionTime = 3 / 60; // 3 minutes in hours
            const settlerAreaRate = 1.5; // m³/hr/m²
            const mixerVolume = totalFlowRate * mixerRetentionTime;
            const settlerArea = totalFlowRate / settlerAreaRate;
            // Assuming 2 extraction + 1 strip stage
            const totalMixerSettlerVolume = (mixerVolume * 3) + (settlerArea * 1.2 * 3); // 1.2m depth


            // Crushing
            const crusherHourlyCapacity = (capacity / A.operatingDays.value) / A.operatingHours.value;
            let jawCrusherSuggestion = "وابسته به F80";
            if (crusherHourlyCapacity < 150) jawCrusherSuggestion = "سری PE 750x1060";
            else if (crusherHourlyCapacity < 300) jawCrusherSuggestion = "سری PE 900x1200";
            else jawCrusherSuggestion = "سری PE 1200x1500";
            
            let hydroconeSuggestion = "وابسته به P80 فکی";
             if (crusherHourlyCapacity < 150) hydroconeSuggestion = "سری CS 160 (ثانویه)";
            else if (crusherHourlyCapacity < 300) hydroconeSuggestion = "سری CS 240 (ثانویه)";
            else hydroconeSuggestion = "سری CS 400 (ثانویه/ثالثیه)";


            // 3. Display Results
            document.getElementById('summary').innerHTML = 
                createResultCard('مس محتوی در کانسنگ', totalCopperInOre, 'تن در سال') +
                createResultCard('تولید نهایی مس کاتدی', finalCopperProduction, 'تن در سال') +
                createResultCard('تولید روزانه مس کاتدی', dailyCopperProductionKg, 'کیلوگرم در روز');

            document.getElementById('heap').innerHTML =
                createResultCard('حجم روزانه کانسنگ', dailyOreVolume, 'متر مکعب') +
                createResultCard('مساحت کل زیرسازی هیپ', totalAreaUnderLeach, 'متر مربع (هکتار: ' + formatNum(totalAreaUnderLeach/10000) + ')') +
                createResultCard('جریان محلول باردار (PLS)', plsFlowRate, 'متر مکعب در ساعت');

            document.getElementById('consumables').innerHTML =
                createResultCard('مصرف روزانه اسید سولفوریک (98%)', dailyAcidTon, 'تن') +
                createResultCard('مصرف روزانه آب جبرانی', dailyWaterM3, 'متر مکعب') +
                createResultCard('مصرف سالانه LIX (یا معادل)', annualLixKg, 'کیلوگرم') +
                createResultCard('مصرف سالانه نفت (یا رقیق‌کننده)', annualKeroseneL / 1000, 'متر مکعب');

            document.getElementById('sxew').innerHTML =
                createResultCard('تعداد سلول‌های الکترووینینگ', ewCells, 'عدد') +
                createResultCard('ظرفیت رکتیفایر', rectifierPower, 'کیلووات (kW)') +
                createResultCard('حجم کل میکسر-ستلرها (تقریبی)', totalMixerSettlerVolume, 'متر مکعب') +
                createResultCard('تعداد کل کاتدها', totalCathodes, 'عدد');

            document.getElementById('crushing').innerHTML =
                createResultCard('ظرفیت ساعتی مدار سنگ‌شکنی', crusherHourlyCapacity, 'تن در ساعت') +
                createResultCard('پیشنهاد سنگ شکن اولیه (فکی)', jawCrusherSuggestion, '') +
                createResultCard('پیشنهاد سنگ شکن ثانویه (مخروطی)', hydroconeSuggestion, '');

            resultsDiv.classList.remove('hidden');
        }
        
        // --- Tab Switching Logic ---
        const tabsContainer = document.getElementById('tabs');
        const tabContentContainer = document.getElementById('tab-content-container');

        tabsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab-btn')) {
                // Deactivate all tabs and content
                tabsContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                tabContentContainer.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // Activate clicked tab and corresponding content
                e.target.classList.add('active');
                const tabName = e.target.getAttribute('data-tab');
                document.getElementById(tabName).classList.add('active');
            }
        });

        // --- Event Listener ---
        calculateBtn.addEventListener('click', performCalculations);
        
        // --- Initial Population ---
        window.onload = () => {
            populateAssumptions();
        };

    </script>
</body>
</html>

